// TODO: A reference CPU implementation